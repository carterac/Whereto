<div class="trending_list">
<ul class="venue_list">
	<% 

	rank = 1
	trending_data = trending({:ll => '40.718493,-73.993177', :radius => 3000})
	categories = ["Bar","Sports Bar","Dive Bar","Pub","Restaurant","Nightclub"]
	
	%>

	<% if trending_data["response"]["venues"].empty? %>
		You're not getting laid tonight.
		<ul class="venue_list">
			<li class="venue">People are LAME!</li>
		</ul>		

	<% else %>

	  <% trending_data["response"]["venues"].each do |i|
		
			good_category = 0
			i['categories'].each do |j|
	  	  		if categories.include?(j['name'])
    		  		good_category = 1
  				end  
			end
          
      if good_category == 1 %>

				<% patron_list = herenow(i['id'])
					girl_count_w = 0
					guy_count_w = 0
					girl_count = 0
					guy_count = 0
					patron_list['response']['hereNow']['items'].each do |k|
						m = ((Time.now.to_i - k['createdAt'])/60)
						p = 1-1/(1+1*2**(-(Float(m)/9-6))) 
						if k['user']['gender'] == 'female'
							girl_count_w += p
							girl_count += 1
						else
							guy_count_w += p
							guy_count += 1
						end
					end
				%>

		<% if girl_count_w.to_f/(girl_count_w.to_f+guy_count_w.to_f)*100 > 35 && girl_count_w.to_f+guy_count_w.to_f > 2 %>	

				<li class="venue round shadow"><span class="rank"><%= rank %></span> 
						<a href="http://maps.google.com/maps?q=<%= i['location']['address'].gsub(',','').split( /  */ ).join(',') %>&new&york&ny" target="_blank"/><%= i['name'] %> <%= i['location']['address'] %></a>
						| <%= format("%.1f\n",girl_count_w.to_f+guy_count_w.to_f) %> Patrons 
						| <%= format("%.1f\n",(girl_count_w.to_f/(girl_count_w.to_f+guy_count_w.to_f)*100)) %>% Girls
					
					
					<span id="<%= i['id'] %>" class="view-button round shadow">View Girls</span></li>
				<% rank +=1 %>
				<% if i['hereNow']['count'] > 0 %>
					<ul class="<%= i['id'] %> patron_list hidden">
					<% patron_list['response']['hereNow']['items'].each do |k| %>

						<% if k['user']['gender'] == 'female' %>
							<li class="patron"><img src="<%= k['user']['photo'] %>" width="75"/><span class="name"><%= k['user']['firstName'] %> <%= k['user']['lastName'] %> </span> - Checked in <%= ((Time.now.to_i - k['createdAt'])/60) %> minutes ago</li>
						<% end %>

					<% end %>
					</ul>
					
					<% end %>
				<% end %>

				

			<% end %>

	  <% end %>
	<% end %>
</ul>
</div>

<script type="text/javascript">

$(document).ready(function(){
	$("span.view-button").click(function(){
		var venue_id = $(this).attr("id");
		var show_list = "ul." + venue_id;
		$("ul.patron_list").addClass("hidden");
		$(show_list).removeClass("hidden");
	});
});

</script>